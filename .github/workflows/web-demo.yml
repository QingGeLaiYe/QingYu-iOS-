name: Web Demo Deploy

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  # æ„å»ºWebæ¼”ç¤ºç‰ˆæœ¬
  build-web-demo:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Create Web Demo
      run: |
        mkdir -p web-demo

        # åˆ›å»ºä¸»é¡µ
        cat > web-demo/index.html << 'EOF'
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è½»è¯­ - å›½é£ç–—æ„ˆAppæ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 414px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 40px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 20px 30px;
            text-align: center;
        }

        .app-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .app-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .search-container {
            margin: 20px;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 16px 20px 16px 50px;
            border: none;
            border-radius: 25px;
            background: #f5f5f7;
            font-size: 16px;
            outline: none;
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #8e8e93;
        }

        .scenes {
            display: flex;
            padding: 0 20px;
            margin-bottom: 20px;
            gap: 12px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .scene-btn {
            flex-shrink: 0;
            padding: 12px 20px;
            border-radius: 20px;
            border: 2px solid #e0e0e0;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scene-btn.active {
            background: #007AFF;
            border-color: #007AFF;
            color: white;
        }

        .track-list {
            padding: 0 20px;
        }

        .track-item {
            display: flex;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .track-item:hover {
            background: #f8f8fa;
            margin: 0 -20px;
            padding: 16px 20px;
        }

        .track-cover {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            background: linear-gradient(45deg, #ddd 25%, #eee 50%, #ddd 75%);
            margin-right: 16px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .track-cover::before {
            content: "ğŸµ";
            font-size: 24px;
        }

        .track-info {
            flex: 1;
        }

        .track-title {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .track-artist {
            font-size: 14px;
            color: #8e8e93;
        }

        .track-duration {
            font-size: 12px;
            color: #8e8e93;
        }

        .track-actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: #f0f0f0;
            color: #007AFF;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            background: #007AFF;
            color: white;
        }

        .player-overlay {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 414px;
            background: white;
            border-top: 1px solid #e0e0e0;
            padding: 20px;
            display: none;
        }

        .player-overlay.active {
            display: block;
        }

        .now-playing {
            text-align: center;
            margin-bottom: 20px;
        }

        .vinyl-record {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(45deg, #222 25%, #333 50%, #222 75%);
            margin: 0 auto 20px;
            position: relative;
            animation: spin 3s linear infinite paused;
        }

        .vinyl-record.playing {
            animation-play-state: running;
        }

        .vinyl-record::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e74c3c;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: #007AFF;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            transform: scale(1.1);
        }

        .control-btn.play-btn {
            width: 60px;
            height: 60px;
            font-size: 24px;
        }

        .demo-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff3b30;
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            z-index: 10;
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="demo-badge">æ¼”ç¤ºç‰ˆæœ¬</div>

        <div class="header">
            <h1 class="app-title">è½»è¯­</h1>
            <p class="app-subtitle">å›½é£ç–—æ„ˆ Â· ç¢ç‰‡æ—¶å…‰</p>
        </div>

        <div class="search-container">
            <span class="search-icon">ğŸ”</span>
            <input type="text" class="search-box" placeholder="æœç´¢æ›²ç›®æˆ–è‰ºæœ¯å®¶">
        </div>

        <div class="scenes">
            <button class="scene-btn active" onclick="switchScene(this, 'zen')">ğŸ§˜ ç¦…æ„é™å¿ƒ</button>
            <button class="scene-btn" onclick="switchScene(this, 'relax')">â˜€ï¸ æ—¥å¸¸è§£å‹</button>
            <button class="scene-btn" onclick="switchScene(this, 'sleep')">ğŸŒ™ ç¡å‰åŠ©çœ </button>
            <button class="scene-btn" onclick="switchScene(this, 'relief')">ğŸ’— ç¼“è§£ç„¦è™‘</button>
        </div>

        <div class="track-list" id="trackList">
            <div class="track-item" onclick="playTrack('ç«¹æ—æ¸…é£')">
                <div class="track-cover"></div>
                <div class="track-info">
                    <div class="track-title">ç«¹æ—æ¸…é£</div>
                    <div class="track-artist">è½»è¯­</div>
                </div>
                <div class="track-duration">0:30</div>
                <div class="track-actions">
                    <button class="action-btn" onclick="toggleCache(this)">â¬‡ï¸</button>
                    <button class="action-btn" onclick="toggleFavorite(this)">ğŸ¤</button>
                </div>
            </div>

            <div class="track-item" onclick="playTrack('å±±æ¶§æºªæµ')">
                <div class="track-cover"></div>
                <div class="track-info">
                    <div class="track-title">å±±æ¶§æºªæµ</div>
                    <div class="track-artist">è½»è¯­</div>
                </div>
                <div class="track-duration">0:25</div>
                <div class="track-actions">
                    <button class="action-btn" onclick="toggleCache(this)">â¬‡ï¸</button>
                    <button class="action-btn" onclick="toggleFavorite(this)">ğŸ¤</button>
                </div>
            </div>

            <div class="track-item" onclick="playTrack('å¤ç´ç¦…éŸ³')">
                <div class="track-cover"></div>
                <div class="track-info">
                    <div class="track-title">å¤ç´ç¦…éŸ³</div>
                    <div class="track-artist">è½»è¯­</div>
                </div>
                <div class="track-duration">0:35</div>
                <div class="track-actions">
                    <button class="action-btn" onclick="toggleCache(this)">â¬‡ï¸</button>
                    <button class="action-btn" onclick="toggleFavorite(this)">ğŸ¤</button>
                </div>
            </div>

            <div class="track-item" onclick="playTrack('æ™¨éœ²å¾®å…‰')">
                <div class="track-cover"></div>
                <div class="track-info">
                    <div class="track-title">æ™¨éœ²å¾®å…‰</div>
                    <div class="track-artist">è½»è¯­</div>
                </div>
                <div class="track-duration">0:20</div>
                <div class="track-actions">
                    <button class="action-btn" onclick="toggleCache(this)">â¬‡ï¸</button>
                    <button class="action-btn" onclick="toggleFavorite(this)">ğŸ¤</button>
                </div>
            </div>

            <div class="track-item" onclick="playTrack('æœˆå…‰æ‘‡ç¯®æ›²')">
                <div class="track-cover"></div>
                <div class="track-info">
                    <div class="track-title">æœˆå…‰æ‘‡ç¯®æ›²</div>
                    <div class="track-artist">è½»è¯­</div>
                </div>
                <div class="track-duration">0:40</div>
                <div class="track-actions">
                    <button class="action-btn" onclick="toggleCache(this)">â¬‡ï¸</button>
                    <button class="action-btn" onclick="toggleFavorite(this)">ğŸ¤</button>
                </div>
            </div>
        </div>

        <div class="player-overlay" id="player">
            <div class="now-playing">
                <div class="vinyl-record" id="vinyl"></div>
                <div style="font-weight: 500; margin-bottom: 4px;" id="nowPlayingTitle">ç«¹æ—æ¸…é£</div>
                <div style="font-size: 14px; color: #8e8e93;">è½»è¯­</div>
            </div>

            <div class="controls">
                <button class="control-btn" onclick="previousTrack()">â®ï¸</button>
                <button class="control-btn play-btn" onclick="togglePlay()" id="playBtn">â–¶ï¸</button>
                <button class="control-btn" onclick="nextTrack()">â­ï¸</button>
            </div>
        </div>
    </div>

    <script>
        let isPlaying = false;
        let currentTrack = 0;
        const tracks = ['ç«¹æ—æ¸…é£', 'å±±æ¶§æºªæµ', 'å¤ç´ç¦…éŸ³', 'æ™¨éœ²å¾®å…‰', 'æœˆå…‰æ‘‡ç¯®æ›²'];

        function switchScene(btn, scene) {
            document.querySelectorAll('.scene-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // æ¨¡æ‹Ÿä¸åŒåœºæ™¯çš„æ›²ç›®
            updateTrackList(scene);
        }

        function updateTrackList(scene) {
            const trackList = document.getElementById('trackList');
            const sceneTracks = {
                'zen': ['ç«¹æ—æ¸…é£', 'å¤ç´ç¦…éŸ³', 'å±±æ¶§æºªæµ'],
                'relax': ['æ™¨éœ²å¾®å…‰', 'é¸Ÿè¯­èŠ±é¦™', 'å’Œé£ç»†é›¨'],
                'sleep': ['æœˆå…‰æ‘‡ç¯®æ›²', 'å¤œç©ºæ˜Ÿè¾°', 'å®é™æ¹–æ³Š'],
                'relief': ['æ±Ÿå—çƒŸé›¨', 'å¿ƒçµæ¸©æ³‰', 'å¹³å’Œä¹‹å¢ƒ']
            };

            const trackDurations = {
                'ç«¹æ—æ¸…é£': '0:30', 'å¤ç´ç¦…éŸ³': '0:35', 'å±±æ¶§æºªæµ': '0:25',
                'æ™¨éœ²å¾®å…‰': '0:20', 'é¸Ÿè¯­èŠ±é¦™': '0:28', 'å’Œé£ç»†é›¨': '0:32',
                'æœˆå…‰æ‘‡ç¯®æ›²': '0:40', 'å¤œç©ºæ˜Ÿè¾°': '0:38', 'å®é™æ¹–æ³Š': '0:36',
                'æ±Ÿå—çƒŸé›¨': '0:33', 'å¿ƒçµæ¸©æ³‰': '0:29', 'å¹³å’Œä¹‹å¢ƒ': '0:31'
            };

            trackList.innerHTML = sceneTracks[scene].map((track, index) => `
                <div class="track-item" onclick="playTrack('${track}')">
                    <div class="track-cover"></div>
                    <div class="track-info">
                        <div class="track-title">${track}</div>
                        <div class="track-artist">è½»è¯­</div>
                    </div>
                    <div class="track-duration">${trackDurations[track] || '0:30'}</div>
                    <div class="track-actions">
                        <button class="action-btn" onclick="toggleCache(this)">â¬‡ï¸</button>
                        <button class="action-btn" onclick="toggleFavorite(this)">ğŸ¤</button>
                    </div>
                </div>
            `).join('');
        }

        function playTrack(title) {
            document.getElementById('nowPlayingTitle').textContent = title;
            document.getElementById('player').classList.add('active');

            // æ·»åŠ è§¦è§‰åé¦ˆæ¨¡æ‹Ÿï¼ˆæŒ¯åŠ¨ï¼‰
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }

        function togglePlay() {
            isPlaying = !isPlaying;
            const btn = document.getElementById('playBtn');
            const vinyl = document.getElementById('vinyl');

            btn.textContent = isPlaying ? 'â¸ï¸' : 'â–¶ï¸';
            vinyl.classList.toggle('playing', isPlaying);

            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
        }

        function toggleCache(btn) {
            btn.textContent = btn.textContent === 'â¬‡ï¸' ? 'âœ…' : 'â¬‡ï¸';
            if (navigator.vibrate) {
                navigator.vibrate(20);
            }
        }

        function toggleFavorite(btn) {
            btn.textContent = btn.textContent === 'ğŸ¤' ? 'â¤ï¸' : 'ğŸ¤';
            if (navigator.vibrate) {
                navigator.vibrate(20);
            }
        }

        function previousTrack() {
            currentTrack = (currentTrack - 1 + tracks.length) % tracks.length;
            playTrack(tracks[currentTrack]);
        }

        function nextTrack() {
            currentTrack = (currentTrack + 1) % tracks.length;
            playTrack(tracks[currentTrack]);
        }

        // æ·»åŠ é¡µé¢å¯è§æ€§æ£€æµ‹ï¼Œä¼˜åŒ–ä½“éªŒ
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // é¡µé¢éšè—æ—¶æš‚åœ
                isPlaying = false;
                document.getElementById('playBtn').textContent = 'â–¶ï¸';
                document.getElementById('vinyl').classList.remove('playing');
            }
        });

        // é˜²æ­¢iOSç¼©æ”¾
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
EOF

        echo "âœ… Webæ¼”ç¤ºé¡µé¢åˆ›å»ºå®Œæˆ"
        ls -la web-demo/

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      if: github.ref == 'refs/heads/main'
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./web-demo
        destination_dir: demo

    - name: Build Summary
      run: |
        echo "# ğŸ‰ Webæ¼”ç¤ºç‰ˆæœ¬æ„å»ºå®Œæˆ!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## âœ… å®Œæˆçš„ä»»åŠ¡:" >> $GITHUB_STEP_SUMMARY
        echo "- [x] Webç•Œé¢æ„å»ºæˆåŠŸ" >> $GITHUB_STEP_SUMMARY
        echo "- [x] å“åº”å¼è®¾è®¡é€‚é…" >> $GITHUB_STEP_SUMMARY
        echo "- [x] å›½é£UIç•Œé¢å®ç°" >> $GITHUB_STEP_SUMMARY
        echo "- [x] äº¤äº’åŠŸèƒ½å®Œæ•´" >> $GITHUB_STEP_SUMMARY
        echo "- [x] å¤šåœºæ™¯åˆ‡æ¢åŠŸèƒ½" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## ğŸŒ ç«‹å³ä½“éªŒ:" >> $GITHUB_STEP_SUMMARY
        echo "1. **è®¿é—®é“¾æ¥**: https://${{ github.repository_owner }}.github.io/QingYu-iOS/demo/" >> $GITHUB_STEP_SUMMARY
        echo "2. **iPhoneä½“éªŒ**: åœ¨Safariä¸­æ‰“å¼€ï¼Œæ·»åŠ åˆ°ä¸»å±å¹•" >> $GITHUB_STEP_SUMMARY
        echo "3. **åŠŸèƒ½ä½“éªŒ**: åœºæ™¯åˆ‡æ¢ã€æ’­æ”¾æ§åˆ¶ã€æ”¶è—ç¼“å­˜ç­‰" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## ğŸµ ä¸»è¦åŠŸèƒ½:" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ¨ **å›½é£ç•Œé¢**: æ½®æ±é£æ ¼+ä¼ ç»Ÿå…ƒç´ " >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ§ **é»‘èƒ¶å”±ç‰‡**: æ—‹è½¬åŠ¨ç”»+è§¦è§‰åé¦ˆ" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ”„ **åœºæ™¯åˆ†ç±»**: ç¦…æ„/è§£å‹/åŠ©çœ /ç„¦è™‘" >> $GITHUB_STEP_SUMMARY
        echo "- â­ **æ”¶è—åŠŸèƒ½**: å¿ƒå½¢åŠ¨ç”»+æ”¶è—ç®¡ç†" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ’¾ **ç¼“å­˜ä¸‹è½½**: å¯è§†åŒ–ä¸‹è½½çŠ¶æ€" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## ğŸ“± iPhoneä½¿ç”¨æ–¹æ³•:" >> $GITHUB_STEP_SUMMARY
        echo "1. æ‰“å¼€Safariæµè§ˆå™¨" >> $GITHUB_STEP_SUMMARY
        echo "2. è®¿é—®ä¸Šæ–¹é“¾æ¥" >> $GITHUB_STEP_SUMMARY
        echo "3. ç‚¹å‡»åˆ†äº«æŒ‰é’®" >> $GITHUB_STEP_SUMMARY
        echo "4. é€‰æ‹©\"æ·»åŠ åˆ°ä¸»å±å¹•\"" >> $GITHUB_STEP_SUMMARY
        echo "5. å°±åƒçœŸAPPä¸€æ ·ä½¿ç”¨äº†ï¼" >> $GITHUB_STEP_SUMMARY